<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Primal vs Dual 1D Widget</title>
  <style>
    body{margin:0;font-family:system-ui;background:#0b0d12;color:#e9eefc}
    .wrap{max-width:950px;margin:20px auto;padding:0 14px}
    .card{background:#111626;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px}
    canvas{width:100%;height:auto;display:block;border-radius:10px;background:#0a0f1f}
    label{display:block;margin-top:10px;color:#aab3c8}
    input{width:100%}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Primal vs Dual: Minimax Visualization</h2>
  <div class="card">
    <canvas id="c" width="860" height="420"></canvas>
    <label>Move Dual Variable λ</label>
    <input id="lam" type="range" min="0" max="4" step="0.01" value="0.0">
    <div class="mono" id="info"></div>
  </div>
</div>

<script>
(() => {
  const c = document.getElementById("c");
  const ctx = c.getContext("2d");
  const s = document.getElementById("lam");
  const info = document.getElementById("info");

  // Problem: min x^2 s.t. x <= -1
  // p* = 1 (at x=-1).
  // L(x, lam) = x^2 + lam(x+1).
  // g(lam) = min_x (x^2 + lam x + lam) => x* = -lam/2 => -lam^2/4 + lam.
  // d* = max (-lam^2/4 + lam) => lam=2 => d*=1.

  // Plot x range [-3, 2], y range [-2, 5]
  const xMin=-3.5, xMax=1.5, yMin=-2, yMax=5;

  function mapX(x){ return 60 + (x-xMin)*(c.width-90)/(xMax-xMin); }
  function mapY(y){ return (c.height-60) - (y-yMin)*(c.height-100)/(yMax-yMin); }

  function f0(x){ return x*x; }
  function fi(x){ return x+1; } // constraint x+1 <= 0
  function L(x,lam){ return x*x + lam*(x+1); }

  function render(){
    const lam = parseFloat(s.value);
    ctx.clearRect(0,0,c.width,c.height);

    // Axes
    ctx.strokeStyle="rgba(255,255,255,0.2)"; ctx.lineWidth=1;
    ctx.beginPath();
    ctx.moveTo(mapX(0),40); ctx.lineTo(mapX(0),c.height-50); // y-axis
    ctx.moveTo(50, mapY(0)); ctx.lineTo(c.width-30, mapY(0)); // x-axis
    ctx.stroke();

    // Draw f0(x) = x^2
    ctx.beginPath(); ctx.strokeStyle="#4ade80"; ctx.lineWidth=3;
    for(let i=0;i<600;i++){
      let x = xMin + (xMax-xMin)*i/599;
      let y = f0(x);
      if(i==0) ctx.moveTo(mapX(x),mapY(y)); else ctx.lineTo(mapX(x),mapY(y));
    }
    ctx.stroke();

    // Draw Lagrangian L(x, lam)
    ctx.beginPath(); ctx.strokeStyle="#60a5fa"; ctx.lineWidth=2; ctx.setLineDash([5,5]);
    let minL = 1e9, minLx = 0;
    for(let i=0;i<600;i++){
      let x = xMin + (xMax-xMin)*i/599;
      let y = L(x,lam);
      if(y<minL){ minL=y; minLx=x; }
      if(i==0) ctx.moveTo(mapX(x),mapY(y)); else ctx.lineTo(mapX(x),mapY(y));
    }
    ctx.stroke(); ctx.setLineDash([]);

    // Draw Feasible Region (x <= -1)
    ctx.fillStyle="rgba(74, 222, 128, 0.1)";
    ctx.fillRect(mapX(xMin), 40, mapX(-1)-mapX(xMin), c.height-90);

    // Draw g(lam) point
    ctx.fillStyle="#60a5fa"; ctx.beginPath();
    ctx.arc(mapX(minLx), mapY(minL), 6, 0, Math.PI*2); ctx.fill();

    // Draw Constraint Boundary x=-1
    ctx.strokeStyle="rgba(255,100,100,0.5)"; ctx.beginPath();
    ctx.moveTo(mapX(-1), 40); ctx.lineTo(mapX(-1), c.height-50); ctx.stroke();

    info.innerHTML =
      `<div class="mono">
        Primal: min x² s.t. x ≤ -1. p* = 1.<br/>
        λ = ${lam.toFixed(2)}<br/>
        Lagrangian L(x,λ) = x² + λ(x+1) (Dashed Blue)<br/>
        Dual Function g(λ) = minₓ L = ${minL.toFixed(3)} (at x=${minLx.toFixed(2)})<br/>
        Weak Duality: g(λ) ≤ p* (${minL.toFixed(3)} ≤ 1.00) is <b>${minL<=1.001?"TRUE":"FALSE"}</b>
       </div>`;
  }

  s.oninput = render;
  render();
})();
</script>
</body>
</html>
